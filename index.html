<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Guild Boss Loot</title>
<script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 p-4">

<!-- Header -->
<div class="flex justify-between items-center mb-4">
  <h1 class="text-2xl font-bold">Guild Boss Loot</h1>
  <button id="admin-btn" class="bg-indigo-600 text-white px-3 py-1 rounded">Admin</button>
</div>

<!-- Recorded Loot Entries Panel -->
<div class="p-4 bg-white border rounded-md">
  <h2 class="text-xl font-semibold mb-2">Recorded Loot Entries</h2>
  <div id="loot-list" class="space-y-3"></div>
</div>

<!-- Admin Phrase Modal -->
<div id="admin-password-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden">
  <div class="bg-white p-4 rounded-lg w-80">
    <h3 id="admin-modal-title" class="font-bold mb-2">Enter Admin Phrase</h3>
    <input id="admin-password-input" type="password" placeholder="Admin Phrase" class="border p-2 rounded w-full mb-3">
    <div class="flex justify-end gap-2">
      <button id="submit-password-btn" class="bg-green-500 text-white px-3 py-1 rounded">Submit</button>
      <button id="close-password-btn" class="bg-gray-300 px-3 py-1 rounded">Close</button>
    </div>
  </div>
</div>

<script type="module">
import { firebaseDB } from './firebase-init.js';
import { doc, getDoc, setDoc } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore.js";

// ===== Admin Phrase Handling =====
const adminBtn = document.getElementById('admin-btn');
const passwordModal = document.getElementById('admin-password-modal');
const passwordInput = document.getElementById('admin-password-input');
const submitPasswordBtn = document.getElementById('submit-password-btn');
const closePasswordBtn = document.getElementById('close-password-btn');
const modalTitle = document.getElementById('admin-modal-title');

const adminDocRef = doc(firebaseDB, 'adminConfig', 'adminLogin');

let isCreating = false;

async function checkAdminPhrase() {
    const adminDoc = await getDoc(adminDocRef);
    if(adminDoc.exists() && adminDoc.data().phrase){
        isCreating = false;
        modalTitle.textContent = "Enter Admin Phrase";
    } else {
        isCreating = true;
        modalTitle.textContent = "Create Admin Phrase";
    }
}

adminBtn.addEventListener('click', async ()=>{
    passwordModal.style.display='flex';
    passwordInput.value='';
    await checkAdminPhrase();
});

closePasswordBtn.addEventListener('click', ()=>{
    passwordModal.style.display='none';
});

submitPasswordBtn.addEventListener('click', async ()=>{
    const entered = passwordInput.value.trim();
    if(!entered) return alert('Enter admin phrase');

    const adminDoc = await getDoc(adminDocRef);

    if(isCreating){
        // First time create password
        await setDoc(adminDocRef, { phrase: entered });
        alert("Admin phrase created successfully!");
        window.location.href='admin.html';
    } else {
        const storedPhrase = adminDoc.data().phrase;
        if(entered === storedPhrase){
            window.location.href='admin.html';
        } else {
            alert("Incorrect admin phrase!");
        }
    }
});
</script>

</body>
</html>