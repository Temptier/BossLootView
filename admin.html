<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Guild Boss Loot - Admin</title>
<script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 p-4">

<!-- Header -->
<div class="flex justify-between items-center mb-4">
  <button id="back-btn" class="bg-gray-300 px-3 py-1 rounded">Back</button>
  <h1 class="text-2xl font-bold">Guild Boss Loot - Admin</h1>
  <button id="change-password-btn" class="bg-yellow-500 text-white px-3 py-1 rounded">Change Admin Phrase</button>
</div>

<!-- Panels -->
<div class="grid grid-cols-1 md:grid-cols-2 gap-4">

  <!-- Boss Loot Panel -->
  <div class="p-4 bg-white border rounded-md">
    <h2 class="text-xl font-semibold mb-2">Boss Loot Panel</h2>
    <!-- Add your Boss / Member / Loot panel content here -->
  </div>

  <!-- Recorded Loot Entries Panel -->
  <div class="p-4 bg-white border rounded-md">
    <h2 class="text-xl font-semibold mb-2">Recorded Loot Entries</h2>
    <div id="loot-list" class="space-y-3"></div>
  </div>

</div>

<!-- Change Password Modal -->
<div id="change-password-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden">
  <div class="bg-white p-4 rounded-lg w-80">
    <h3 class="font-bold mb-2">Enter New Admin Phrase</h3>
    <input id="new-password-input" type="password" placeholder="New Phrase" class="border p-2 rounded w-full mb-3">
    <div class="flex justify-end gap-2">
      <button id="submit-new-password-btn" class="bg-green-500 text-white px-3 py-1 rounded">Update</button>
      <button id="close-new-password-btn" class="bg-gray-300 px-3 py-1 rounded">Close</button>
    </div>
  </div>
</div>

<script type="module">
import { firebaseDB } from './firebase-init.js';
import { doc, setDoc } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore.js";

// ===== Back Button =====
document.getElementById('back-btn').addEventListener('click', ()=>{
    window.location.href = 'index.html';
});

// ===== Change Admin Phrase =====
const changeBtn = document.getElementById('change-password-btn');
const modal = document.getElementById('change-password-modal');
const closeModalBtn = document.getElementById('close-new-password-btn');
const submitNewBtn = document.getElementById('submit-new-password-btn');
const newPasswordInput = document.getElementById('new-password-input');

const adminDocRef = doc(firebaseDB, 'adminConfig', 'adminLogin');

changeBtn.addEventListener('click', ()=>{
    modal.style.display='flex';
    newPasswordInput.value='';
});

closeModalBtn.addEventListener('click', ()=>{
    modal.style.display='none';
});

submitNewBtn.addEventListener('click', async ()=>{
    const newPhrase = newPasswordInput.value.trim();
    if(!newPhrase) return alert("Enter a new phrase");

    try {
        await setDoc(adminDocRef, { phrase: newPhrase });
        alert("Admin phrase updated successfully!");
        modal.style.display='none';
    } catch(e){
        console.error(e);
        alert("Error updating admin phrase");
    }
});
</script>

</body>
</html>